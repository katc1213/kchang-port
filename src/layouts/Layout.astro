---
import Header from "@components/Header.astro";
import Wallpaper from "@components/Wallpaper.astro";
import "@fontsource/be-vietnam-pro";
import "@fontsource-variable/gabarito";
import { SITE_CONFIG } from "@config";
import Footer from "@components/Footer.astro";

const {
  title,
  description,
  siteLogo,
  navLinks,
  lang,
  author,
  socialLinks,
  socialImage,
  canonicalURL = new URL(Astro.url.pathname, Astro.site).href,
} = SITE_CONFIG;

const ogImgUrl = canonicalURL + socialImage;
---

<!doctype html>
<html lang={lang} class="scroll-pt-16 scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content={description} />
    <meta name="author" content={author} />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/png" href="/kchang-pfp.png" />
    <meta name="generator" content={Astro.generator} />
    <title>{title}</title>

    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:url" content={canonicalURL} />
    <meta property="og:image" content={ogImgUrl} />

    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content={canonicalURL} />
    <meta property="twitter:title" content={title} />
    <meta property="twitter:description" content={description} />
    <meta property="twitter:image" content={ogImgUrl} />

    <!-- Add JetBrains Mono and Orbitron fonts for the wallpaper -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;600&family=Orbitron:wght@500;700;900&display=swap" rel="stylesheet">
  </head>
  <body class="font-sans relative">
    <!-- Animated Wallpaper Background -->
    <Wallpaper />
    
    <!-- Dark overlay that appears on scroll -->
    <div id="scroll-overlay" class="fixed inset-0 bg-black pointer-events-none transition-opacity duration-500 opacity-0 z-[5]"></div>
    
    <Header siteLogo={siteLogo} navLinks={navLinks} />
    <main class="w-full px-8 md:px-16 lg:px-24 relative z-10">
      <slot />
    </main>
    <Footer author={author} socialLinks={socialLinks} />
  </body>
</html>

<script>
  // Darken background when scrolling past hero
  window.addEventListener('scroll', () => {
    const heroSection = document.getElementById('hero');
    const overlay = document.getElementById('scroll-overlay');
    
    if (!heroSection || !overlay) return;
    
    const heroHeight = heroSection.offsetHeight;
    const scrollPosition = window.scrollY;
    
    // Calculate opacity based on scroll position
    // Starts fading in after 50% of hero is scrolled
    const fadeStart = heroHeight * 0.5;
    const fadeEnd = heroHeight;
    
    if (scrollPosition < fadeStart) {
      overlay.style.opacity = '0';
    } else if (scrollPosition >= fadeEnd) {
      overlay.style.opacity = '0.7'; // Maximum darkness (70% black overlay)
    } else {
      // Gradual fade between fadeStart and fadeEnd
      const progress = (scrollPosition - fadeStart) / (fadeEnd - fadeStart);
      overlay.style.opacity = String(progress * 0.7);
    }
  });
</script>